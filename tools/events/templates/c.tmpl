// Â© 2021 Qualcomm Innovation Center, Inc. All rights reserved.
//
// 2019 Cog Systems Pty Ltd.
//
// SPDX-License-Identifier: BSD-3-Clause
// This file is automatically generated.
#set empty=True

\#include <hyptypes.h>
\#include <compiler.h>
#for i in $includes
\#include $i
#end for
#if $extra_includes

#end if
#for i in $extra_includes
\#include <$i>
#end for

\#include <events/${name}.h>
#for h in $called_handlers
#set empty=False

$h.return_type
${h.name}(#slurp
#set sep = ''
#set params = list($h.params)
#if $params
#for p in $params
#set space = '' if p.type.endswith('*') else ' '
${sep}${p.type}${space}${p.name}#slurp
#set sep=', '
#end for
#else
void#slurp
#end if
);
#end for
#def prototype(e)
$e.return_type
trigger_${e.name}_event(#slurp
#set sep = ''
#if $e.params
#for p in $e.params
#set space = '' if p.type.endswith('*') else ' '
${sep}${p.type}${space}${p.name}#slurp
#set sep=', '
#end for
#else
void#slurp
#end if
)#slurp
#end def
#def call(s)
#if s.handler is not None
${s.handler.name}(${', '.join(s.handler.args)})#slurp
#elif s.constant is not None
${s.constant}#slurp
#else
#raise Exception("No handler or constant for subscription " + str($s))
#end if
#end def
#for e in $simple_events

$prototype(e)
{
#for p in sorted(e.unused_param_names)
    (void)$p;
#end for
#for s in e.subscribers
    $call(s);
#end for
}
#end for
#for e in $handled_events

$prototype(e)
{
#for p in sorted(e.unused_param_names)
    (void)$p;
#end for
#if e.subscribers
    $e.return_type ret;

#for s in e.subscribers
    ret = $call(s);
    if (ret != $e.default) {
        goto out;
    }

#end for
out:
    return ret;
#else
    return $e.default;
#end if
}
#end for
#for e in $multi_events

$prototype(e)
{
#for p in sorted(e.unused_param_names)
    (void)$p;
#end for
#if e.subscribers
    $e.count.type _ret;
#end if
#for s in e.subscribers
    _ret = $call(s);
    if (_ret >= $e.count.name) {
        return ($e.count.type)0;
    }
    $e.count.name -= _ret;
#end for
    return $e.count.name;
}
#end for
#for e in $setup_events

$prototype(e)
{
#for p in sorted(e.unused_param_names)
    (void)$p;
#end for
    $e.result.type $e.result.name = $e.result.default;

#set first = True
#for s in e.subscribers
#if first
#set first = False
#else
    if (compiler_expected($e.result.name == $e.success)) {
#end if
    $e.result.name = $call(s);
#end for

#for s in tuple(reversed(e.subscribers))[1:]
#if s.unwinder is not None
    if (compiler_unexpected($e.result.name != $e.success)) {
        ${s.unwinder.name}(${', '.join(s.unwinder.args)});
    }
#end if
    }
#end for

    return $e.result.name;
}
#end for
#for e in $selector_events

\#pragma clang diagnostic push
\#pragma clang diagnostic ignored "-Wswitch-enum"

$prototype(e)
{
#for p in sorted(e.unused_param_names)
    (void)$p;
#end for
    $e.return_type ret;

    switch ($e.selector.name) {
#for s in e.subscribers
#for selector in $s.selectors
    case $selector:
#end for
        ret = $call(s);
        break;
#end for
    default:
        ret = $e.result.default;
        break;
    }

    return ret;
}

\#pragma clang diagnostic pop
#end for
#if empty
extern char __empty_events_template;
#end if
